import{a as _}from"/build/_shared/chunk-K3LLJEF6.js";import{a as $,b as S}from"/build/_shared/chunk-BVJBT3X3.js";import{d as m}from"/build/_shared/chunk-T36URGAI.js";var t=m($(),1);var e=m(S(),1),R=(0,t.lazy)(()=>import("/build/_shared/ProjectSummary-O6J6GUKV.js")),F=(0,t.lazy)(()=>import("/build/_shared/Invoiced-A63EN7RZ.js")),A=(0,t.lazy)(()=>import("/build/_shared/ActionItems-IWL3UWZY.js")),E=(0,t.lazy)(()=>import("/build/_shared/SummaryPercentages-VTVVHH6Y.js")),J=(0,t.lazy)(()=>import("/build/_shared/WorkInprogress-HIIY3F3J.js")),z=(0,t.lazy)(()=>import("/build/_shared/RecentPhtotos-RGPZYIYN.js")),M=(0,t.lazy)(()=>import("/build/_shared/Schedular-FWN7NMUL.js")),T=(0,t.lazy)(()=>import("/build/_shared/Top-4F6IOXKS.js")),U=()=>[{title:"Project Dashboard"},{name:"description",content:"Project management dashboard"}];function b({projectId:o,userId:n,compId:r,location:s}){let[i,f]=(0,t.useState)(null),[P,y]=(0,t.useState)(!0),[v,w]=(0,t.useState)(null),[c,N]=(0,t.useState)(o),[p,j]=(0,t.useState)(n),[l,x]=(0,t.useState)(r),[u,L]=(0,t.useState)(s);JSON.parse(typeof window<"u"&&window.localStorage.getItem("currProject"))!==c&&typeof window<"u"&&s&&(window.location.href=s),console.log("currentProjectID =======>>>>>>>>",JSON.parse(typeof window<"u"&&window.localStorage.getItem("currProject"))!==c),console.log("projectID =======>>>>>>>>",c),console.log("userId =======>>>>>>>>",p),console.log("COMPiD =======>>>>>>>>",l),console.log("CURRENT LOCATION =======>>>>>>>>",u);let g=(0,t.useCallback)(async()=>{try{y(!0),w(null),console.log("Fetching data...");let a=new FormData;a.append("op","get_project_detail"),a.append("project_id",o!==""?c.toString():"0"),a.append("is_refresh","0"),a.append("record_type","project"),a.append("version","web"),a.append("from","panel"),a.append("iframe_call","0"),a.append("tz","+5:30"),a.append("tzid","Asia/Calcutta"),a.append("curr_time",new Date().toISOString()),a.append("force_login","0"),a.append("global_project",""),a.append("user_id",n),a.append("company_id",r);let h=await _.post(`https://api-cfdev.contractorforeman.net/service.php?opp=get_project_detail&c=${r}&u=${n}&p=manage_projects`,a);console.log("Data fetched successfully",h?.data);let O=h?.data?.data;f(O)}catch(a){console.error("Error fetching data:",a),f(null),w("Failed to load data. Please try again.")}finally{y(!1)}},[o,n,r,c,p,l,u,JSON.parse(typeof window<"u"&&window.localStorage.getItem("project"))]);if((0,t.useEffect)(()=>{let a=JSON.parse(typeof window<"u"&&window.localStorage.getItem("currProject"))!==c||o!==c||n!==p||r!==l||s!==u;console.log("propsChanged =======>>>>>",a),a?(console.log("Props changed, fetching new data"),g(),N(o),j(n),x(r),L(s)):console.log("No prop changes, skipping data fetch")},[o,n,r,s,g,c,p,l,u]),(0,t.useEffect)(()=>{g()},[]),P)return(0,e.jsx)("div",{className:"flex justify-center items-center h-screen",children:"Loading..."});if(v)return(0,e.jsxs)("div",{className:"flex flex-col justify-center items-center h-screen",children:[(0,e.jsx)("p",{children:v}),(0,e.jsx)("button",{onClick:g,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded",children:"Retry"})]});if(!i)return(0,e.jsx)("div",{className:"flex justify-center items-center h-screen",children:"No data available"});let{project_summary:k,wip_widget:C,customer_additional_contacts:D,billing_vs_actual:I}=i,d="bg-white border rounded-md hover:shadow-lg transition-shadow duration-500";return(0,e.jsx)(e.Fragment,{children:i?(0,e.jsxs)("div",{className:"space-y-4 p-4 overflow-y-auto sidebar",children:[(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(t.Suspense,{fallback:(0,e.jsx)("p",{children:"Loading Project topbar..."}),children:(0,e.jsx)(T,{data:I??{}})})}),(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3",children:[(0,e.jsx)("div",{className:`${d} p-4`,children:(0,e.jsx)(t.Suspense,{fallback:(0,e.jsx)("p",{children:"Loading Project Summary..."}),children:(0,e.jsx)(R,{data:k??{}})})}),(0,e.jsx)("div",{className:`${d} px-4 pt-4`,children:(0,e.jsx)(t.Suspense,{fallback:(0,e.jsx)("p",{children:"Loading Summary Percentages..."}),children:(0,e.jsx)(E,{data:i})})}),(0,e.jsx)("div",{className:`${d} px-4 pt-4`,children:(0,e.jsx)(t.Suspense,{fallback:(0,e.jsx)("p",{children:"Loading Action Items..."}),children:(0,e.jsx)(A,{projectId:o,userId:n,compId:r,location:s})})}),(0,e.jsx)("div",{children:(0,e.jsx)(t.Suspense,{fallback:(0,e.jsx)("p",{children:"Loading Invoiced..."}),children:(0,e.jsx)(F,{data:i,customer_additional_contacts:D})})}),(0,e.jsx)("div",{className:`${d} px-4 pb-2 lg:pt-4`,children:(0,e.jsx)(t.Suspense,{fallback:(0,e.jsx)("p",{children:"Loading Work In Progress..."}),children:(0,e.jsx)(J,{data:C})})}),(0,e.jsx)("div",{className:`${d} p-4`,children:(0,e.jsx)(t.Suspense,{fallback:(0,e.jsx)("p",{children:"Loading Recent Photos..."}),children:(0,e.jsx)(z,{data:i})})})]}),(0,e.jsx)("div",{className:`${d} px-4 h-60`,children:(0,e.jsx)(t.Suspense,{fallback:(0,e.jsx)("p",{children:"Loading Scheduler..."}),children:(0,e.jsx)(M,{projectId:o,userId:n,compId:r,location:s})})})]},o):(0,e.jsx)("p",{children:"Loading data......."})})}export{b as default,U as meta};
